include:
  - '/opt/unetlab/libs/.all_node_active.yaml'
  - '/opt/unetlab/libs/.scripts_get_ip.yaml'
  - '/opt/unetlab/libs/.scripts_ping_ip.yaml'
  - '/opt/unetlab/libs/.check_ping.yaml'
  - '/opt/unetlab/libs/.ios_config.yaml'

all_node_active:
  extends: .all_node_active
  id: 1
  before_script:
    - allNodeId=("R1" "R2" "R3" "PC1" "PC2" "S1")

node_have_ip:
  id: 2
  title: "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð°Ð´Ñ€ÐµÑÐ¾Ð² ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²"
  description: "Ð˜Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°Ð¼ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ñ‹ IP Ð°Ð´Ñ€ÐµÑÐ°"
  before_script:
    - !reference [ .scripts_get_ip all ]
  script:
    - echo "[R1] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - R1_e00_10=$(getRouterIp R1 eth0/0.10)
    - echo "[R1] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0.10 = $R1_e00_10"
    - R1_e00_20=$(getRouterIp R1 eth0/0.20)
    - echo "[R1] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0.20 = $R1_e00_20"
    - R1_e01=$(getRouterIp R1 eth0/1)
    - echo "[R1] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/1 = $R1_e01"

    - echo "[R3] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - R3_e00_10=$(getRouterIp R3 eth0/0.10)
    - echo "[R3] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0.10 = $R3_e00_10"
    - R3_e00_20=$(getRouterIp R3 eth0/0.20)
    - echo "[R3] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0.20 = $R3_e00_20"
    - R3_e01=$(getRouterIp R3 eth0/1)
    - echo "[R3] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/1 = $R3_e01"

    - echo "[R2] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - R2_e00=$(getRouterIp R2 eth0/0)
    - echo "[R2] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0 = $R2_e00"
    - R2_e01=$(getRouterIp R2 eth0/1)
    - echo "[R2] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/1 = $R2_e01"
    - R2_lo1=$(getRouterIp R2 lo1)
    - echo "[R2] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ lo1 = $R2_lo1"

    - echo "[PC1] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - PC1_eth1=$(getLinuxIp PC1 eth1)
    - echo "[PC1] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth1 = $PC1_eth1"

    - echo "[PC2] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - PC2_eth1=$(getLinuxIp PC2 eth1)
    - echo "[PC2] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth1 = $PC2_eth1"
    - |
      # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð²ÑÐµÑ… IP Ð°Ð´Ñ€ÐµÑÐ¾Ð²
      declare -A ipCheck=(
        ["R1, eth0/0.10"]=$R1_e00_10
        ["R1, eth0/0.20"]=$R1_e00_20
        ["R1, eth0/1"]=$R1_e01
        ["R3, eth0/0.10"]=$R3_e00_10
        ["R3, eth0/0.20"]=$R3_e00_20
        ["R3, eth0/1"]=$R3_e01
        ["R2, eth0/0"]=$R2_e00
        ["R2, eth0/1"]=$R2_e01
        ["R2, lo1"]=$R2_lo1
        ["PC1, eth1"]=$PC1_eth1
        ["PC2, eth1"]=$PC2_eth1
      )
      for key in "${!ipCheck[@]}"; do
        value="${ipCheck[$key]}"
        if [[ -z "$value" ]] ; then
          echo "ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ip Ð°Ð´Ñ€ÐµÑÐ° Ð½Ð° $key"; exit 1
        fi
      done

      echo "Ð¢ÐµÑÑ‚ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"

ping_all:
  id: 3
  title: "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ²ÑÐ·Ð½Ð¾ÑÑ‚Ð¸ PC"
  description: "Ð£Ð·Ð»Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ð¸Ð½Ð³Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³ Ð´Ñ€ÑƒÐ³Ð°"
  before_script:
    - !reference [ .scripts_get_ip all ]
    - !reference [ .scripts_ping_ip all ]
    - !reference [ .check_ping ]
  script:
    - PC1_eth1=$(getLinuxIp PC1 eth1)
    - PC2_eth1=$(getLinuxIp PC2 eth1)
    - |
      # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð²ÑÐµÑ… IP Ð°Ð´Ñ€ÐµÑÐ¾Ð²
      declare -A ipCheck=(
        ["PC1, eth1"]=$PC1_eth1
        ["PC2, eth1"]=$PC2_eth1
      )
      for key in "${!ipCheck[@]}"; do
        value="${ipCheck[$key]}"
        if [[ -z "$value" ]] ; then
          echo "ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ip Ð°Ð´Ñ€ÐµÑÐ° Ð½Ð° $key"; exit 1
        fi
      done
    - |
      TELNET_TIMEOUT=7
      checkPing "[PC1]->[PC2]" "pingLinuxIp PC1 $PC2_eth1"
      checkPing "[PC2]->[PC1]" "pingLinuxIp PC2 $PC1_eth1"

      echo "Ð¢ÐµÑÑ‚ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"

ping_loopback:
  id: 4
  title: "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ²ÑÐ·Ð½Ð¾ÑÑ‚Ð¸ PC Ð¸ loopback"
  description: "Ð£Ð·Ð»Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ð¸Ð½Ð³Ð¾Ð²Ð°Ñ‚ÑŒ loopback"
  before_script:
    - !reference [ .scripts_get_ip all ]
    - !reference [ .scripts_ping_ip all ]
    - !reference [ .check_ping ]
  script:
    - PC1_eth1=$(getLinuxIp PC1 eth1)
    - PC2_eth1=$(getLinuxIp PC2 eth1)
    - R2_lo1=$(getRouterIp R2 lo1)
    - |
      # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð²ÑÐµÑ… IP Ð°Ð´Ñ€ÐµÑÐ¾Ð²
      declare -A ipCheck=(
        ["PC1, eth1"]=$PC1_eth1
        ["PC2, eth1"]=$PC2_eth1
        ["R2, lo1"]=$R2_lo1
      )
      for key in "${!ipCheck[@]}"; do
        value="${ipCheck[$key]}"
        if [[ -z "$value" ]] ; then
          echo "ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ip Ð°Ð´Ñ€ÐµÑÐ° Ð½Ð° $key"; exit 1
        fi
      done
    - |
      TELNET_TIMEOUT=7
      checkPing "[PC1]->[R2]" "pingLinuxIp PC1 $R2_lo1"
      checkPing "[PC2]->[R2]" "pingLinuxIp PC2 $R2_lo1"

      echo "Ð¢ÐµÑÑ‚ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"

hsrp_check:
  id: 5
  title: "Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ HSRP"
  description: "ÐŸÑ€Ð¸ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ¾Ð² ÑÐ²ÑÐ·Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð¾Ð»Ð¶Ð½Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ"
  before_script:
    - !reference [ .scripts_get_ip all ]
    - !reference [ .scripts_ping_ip all ]
    - !reference [ .check_ping ]
    - !reference [ .disable_interface ]
    - !reference [ .enable_interface ]
  script:
    - PC1_eth1=$(getLinuxIp PC1 eth1)
    - PC2_eth1=$(getLinuxIp PC2 eth1)
    - R2_lo1=$(getRouterIp R2 lo1)
    - |
      # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð²ÑÐµÑ… IP Ð°Ð´Ñ€ÐµÑÐ¾Ð²
      declare -A ipCheck=(
        ["PC1, eth1"]=$PC1_eth1
        ["PC2, eth1"]=$PC2_eth1
        ["R2, lo1"]=$R2_lo1
      )
      for key in "${!ipCheck[@]}"; do
        value="${ipCheck[$key]}"
        if [[ -z "$value" ]] ; then
          echo "ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ip Ð°Ð´Ñ€ÐµÑÐ° Ð½Ð° $key"; exit 1
        fi
      done
    - |
      TELNET_TIMEOUT=10

      disableInterface R2 e0/0
      disableInterface R1 e0/1

      echo "Ð–Ð´ÐµÐ¼ 10 ÑÐµÐºÑƒÐ½Ð´.."
      sleep 10

      checkPing "[PC1]->[R2]" "pingLinuxIp PC1 $R2_lo1"
      checkPing "[PC2]->[R2]" "pingLinuxIp PC2 $R2_lo1"
      checkPing "[PC1]->[PC2]" "pingLinuxIp PC1 $PC2_eth1"
      checkPing "[PC2]->[PC1]" "pingLinuxIp PC2 $PC1_eth1"

      enableInterface R2 e0/0
      enableInterface R1 e0/1

      echo "ÐžÐº, Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼.."

      disableInterface R2 e0/1
      disableInterface R3 e0/1

      echo "Ð–Ð´ÐµÐ¼ 10 ÑÐµÐºÑƒÐ½Ð´.."
      sleep 10

      checkPing "[PC1]->[R2]" "pingLinuxIp PC1 $R2_lo1"
      checkPing "[PC2]->[R2]" "pingLinuxIp PC2 $R2_lo1"
      checkPing "[PC1]->[PC2]" "pingLinuxIp PC1 $PC2_eth1"
      checkPing "[PC2]->[PC1]" "pingLinuxIp PC2 $PC1_eth1"

      enableInterface R2 e0/1
      enableInterface R3 e0/1

      echo "Ð¢ÐµÑÑ‚ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"

# disable_R2_e00:
#   id: 6
#   title: "[R2 e0/0]->ðŸ”´ [R1 e0/1]->ðŸ”´"
#   description: ""
#   before_script:
#     - !reference [ .disable_interface ]
#   script:
#     - |
#       disableInterface R2 e0/0
#       disableInterface R1 e0/1

# enable_R2_e00:
#   id: 7
#   title: "[R2 e0/0]->ðŸŸ¢ [R1 e0/1]->ðŸŸ¢"
#   description: ""
#   before_script:
#     - !reference [ .enable_interface ]
#   script:
#     - |
#       enableInterface R2 e0/0
#       enableInterface R1 e0/1

# disable_R2_e01:
#   id: 8
#   title: "[R2 e0/1]->ðŸ”´ [R3 e0/1]->ðŸ”´"
#   description: ""
#   before_script:
#     - !reference [ .disable_interface ]
#   script:
#     - |
#       disableInterface R2 e0/1
#       disableInterface R3 e0/1

# enable_R2_e01:
#   id: 9
#   title: "[R2 e0/1]->ðŸŸ¢ [R3 e0/1]->ðŸŸ¢"
#   description: ""
#   before_script:
#     - !reference [ .enable_interface ]
#   script:
#     - |
#       enableInterface R2 e0/1
#       enableInterface R3 e0/1