include:
  - '/opt/unetlab/libs/.all_node_active.yaml'
  - '/opt/unetlab/libs/.scripts_get_ip.yaml'
  - '/opt/unetlab/libs/.scripts_ping_ip.yaml'
  - '/opt/unetlab/libs/.check_ping.yaml'
  - '/opt/unetlab/libs/.ios_config.yaml'

all_node_active:
  extends: .all_node_active
  id: 1
  before_script:
    - allNodeId=("R1" "R2" "R3" "PC1" "PC2" "S1")

node_have_ip:
  id: 2
  title: "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð°Ð´Ñ€ÐµÑÐ¾Ð² ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²"
  description: "Ð˜Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°Ð¼ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ñ‹ IP Ð°Ð´Ñ€ÐµÑÐ°"
  before_script:
    - !reference [ .scripts_get_ip all ]
  script:
    - echo "[R1] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - R1_e00_10=$(getRouterIp R1 eth0/0.10)
    - echo "[R1] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0.10 = $R1_e00_10"
    - R1_e00_20=$(getRouterIp R1 eth0/0.20)
    - echo "[R1] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0.20 = $R1_e00_20"
    - R1_e01=$(getRouterIp R1 eth0/1)
    - echo "[R1] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/1 = $R1_e01"

    - echo "[R3] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - R3_e00_10=$(getRouterIp R3 eth0/0.10)
    - echo "[R3] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0.10 = $R3_e00_10"
    - R3_e00_20=$(getRouterIp R3 eth0/0.20)
    - echo "[R3] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0.20 = $R3_e00_20"
    - R3_e01=$(getRouterIp R3 eth0/1)
    - echo "[R3] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/1 = $R3_e01"

    - echo "[R2] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - R2_e00=$(getRouterIp R2 eth0/0)
    - echo "[R2] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/0 = $R2_e00"
    - R2_e01=$(getRouterIp R2 eth0/1)
    - echo "[R2] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth0/1 = $R2_e01"
    - R2_lo1=$(getRouterIp R2 lo1)
    - echo "[R2] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ lo1 = $R2_lo1"

    - echo "[PC1] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - PC1_eth1=$(getLinuxIp PC1 eth1)
    - echo "[PC1] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth1 = $PC1_eth1"

    - echo "[PC2] ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ..."
    - PC2_eth1=$(getLinuxIp PC2 eth1)
    - echo "[PC2] ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½ eth1 = $PC2_eth1"
    - |
      # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð²ÑÐµÑ… IP Ð°Ð´Ñ€ÐµÑÐ¾Ð²
      declare -A ipCheck=(
        ["R1, eth0/0.10"]=$R1_e00_10
        ["R1, eth0/0.20"]=$R1_e00_20
        ["R1, eth0/1"]=$R1_e01
        ["R3, eth0/0.10"]=$R3_e00_10
        ["R3, eth0/0.20"]=$R3_e00_20
        ["R3, eth0/1"]=$R3_e01
        ["R2, eth0/0"]=$R2_e00
        ["R2, eth0/1"]=$R2_e01
        ["R2, lo1"]=$R2_lo1
        ["PC1, eth1"]=$PC1_eth1
        ["PC2, eth1"]=$PC2_eth1
      )
      for key in "${!ipCheck[@]}"; do
        value="${ipCheck[$key]}"
        if [[ -z "$value" ]] ; then
          echo "ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ip Ð°Ð´Ñ€ÐµÑÐ° Ð½Ð° $key"; exit 1
        fi
      done

ping_all:
  id: 3
  title: "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ²ÑÐ·Ð½Ð¾ÑÑ‚Ð¸ PC"
  description: "Ð£Ð·Ð»Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ð¸Ð½Ð³Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³ Ð´Ñ€ÑƒÐ³Ð°"
  before_script:
    - !reference [ .scripts_get_ip all ]
    - !reference [ .scripts_ping_ip all ]
    - !reference [ .check_ping ]
  script:
    - PC1_eth1=$(getLinuxIp PC1 eth1)
    - PC2_eth1=$(getLinuxIp PC2 eth1)
    - |
      # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð²ÑÐµÑ… IP Ð°Ð´Ñ€ÐµÑÐ¾Ð²
      declare -A ipCheck=(
        ["PC1, eth1"]=$PC1_eth1
        ["PC2, eth1"]=$PC2_eth1
      )
      for key in "${!ipCheck[@]}"; do
        value="${ipCheck[$key]}"
        if [[ -z "$value" ]] ; then
          echo "ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ip Ð°Ð´Ñ€ÐµÑÐ° Ð½Ð° $key"; exit 1
        fi
      done
    - |
      TELNET_TIMEOUT=7
      checkPing "[PC1]->[PC2]" "pingLinuxIp PC1 $PC2_eth1"
      checkPing "[PC2]->[PC1]" "pingLinuxIp PC2 $PC1_eth1"

      echo "Success"

ping_loopback:
  id: 4
  title: "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ²ÑÐ·Ð½Ð¾ÑÑ‚Ð¸ PC Ð¸ loopback"
  description: "Ð£Ð·Ð»Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ð¸Ð½Ð³Ð¾Ð²Ð°Ñ‚ÑŒ loopback"
  before_script:
    - !reference [ .scripts_get_ip all ]
    - !reference [ .scripts_ping_ip all ]
    - !reference [ .check_ping ]
  script:
    - PC1_eth1=$(getLinuxIp PC1 eth1)
    - PC2_eth1=$(getLinuxIp PC2 eth1)
    - R2_lo1=$(getRouterIp R2 lo1)
    - |
      # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð²ÑÐµÑ… IP Ð°Ð´Ñ€ÐµÑÐ¾Ð²
      declare -A ipCheck=(
        ["PC1, eth1"]=$PC1_eth1
        ["PC2, eth1"]=$PC2_eth1
        ["R2, lo1"]=$R2_lo1
      )
      for key in "${!ipCheck[@]}"; do
        value="${ipCheck[$key]}"
        if [[ -z "$value" ]] ; then
          echo "ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ip Ð°Ð´Ñ€ÐµÑÐ° Ð½Ð° $key"; exit 1
        fi
      done
    - |
      TELNET_TIMEOUT=7
      checkPing "[PC1]->[R2]" "pingLinuxIp PC1 $R2_lo1"
      checkPing "[PC2]->[R2]" "pingLinuxIp PC2 $R2_lo1"

      echo "Success"

disable_R1_e00:
  id: 5
  title: "[R1 e0/0]->ðŸ”´"
  description: "Ð­Ñ‚Ð¾Ñ‚ Ð²ÑÐ¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ HSRP. ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚ 4."
  before_script:
    - !reference [ .disable_interface ]
  script:
    - |
      disableInterface R1 e0/0

enable_R1_e00:
  id: 6
  title: "[R1 e0/0]->ðŸŸ¢"
  description: ""
  before_script:
    - !reference [ .enable_interface ]
  script:
    - |
      enableInterface R1 e0/0

disable_R3_e00:
  id: 7
  title: "[R3 e0/0]->ðŸ”´"
  description: ""
  before_script:
    - !reference [ .disable_interface ]
  script:
    - |
      disableInterface R3 e0/0

enable_R3_e00:
  id: 8
  title: "[R3 e0/0]->ðŸŸ¢"
  description: ""
  before_script:
    - !reference [ .enable_interface ]
  script:
    - |
      enableInterface R3 e0/0

disable_R2_e00:
  id: 9
  title: "[R2 e0/0]->ðŸ”´ [R1 e0/1]->ðŸ”´"
  description: ""
  before_script:
    - !reference [ .disable_interface ]
  script:
    - |
      disableInterface R2 e0/0
      disableInterface R1 e0/1

enable_R2_e00:
  id: 10
  title: "[R2 e0/0]->ðŸŸ¢ [R1 e0/1]->ðŸŸ¢"
  description: ""
  before_script:
    - !reference [ .enable_interface ]
  script:
    - |
      enableInterface R2 e0/0
      enableInterface R1 e0/1

disable_R2_e01:
  id: 11
  title: "[R2 e0/1]->ðŸ”´ [R3 e0/1]->ðŸ”´"
  description: ""
  before_script:
    - !reference [ .disable_interface ]
  script:
    - |
      disableInterface R2 e0/1
      disableInterface R3 e0/1

enable_R2_e01:
  id: 12
  title: "[R2 e0/1]->ðŸŸ¢ [R3 e0/1]->ðŸŸ¢"
  description: ""
  before_script:
    - !reference [ .enable_interface ]
  script:
    - |
      enableInterface R2 e0/1
      enableInterface R3 e0/1